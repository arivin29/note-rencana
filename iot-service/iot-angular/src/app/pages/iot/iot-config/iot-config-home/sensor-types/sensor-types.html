<div class="d-flex align-items-center mb-3 flex-wrap gap-2">
    <div>
        <h2 class="mb-0">Sensor Types</h2>
        <div class="text-muted small">Master kategori sensor, unit, dan formula konversi</div>
    </div>
    <div class="ms-auto d-flex align-items-center gap-2 flex-wrap justify-content-end">
        <div class="input-group w-auto">
            <span class="input-group-text bg-transparent border-end-0 text-muted"><i class="fa fa-search"></i></span>
            <input type="text" class="form-control border-start-0 ps-0" placeholder="Cari kategori / unit / formula"
                [(ngModel)]="search">
        </div>
        <button class="btn btn-theme" (click)="openCreateDrawer()">
            <i class="fa fa-plus me-2"></i>Tambah Sensor Type
        </button>
    </div> 
</div>

<!-- Loading State -->
<div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-theme" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    <div class="text-muted mt-2">Loading sensor types...</div>
</div>

<!-- Error State -->
<div *ngIf="error && !isLoading" class="alert alert-danger">
    <i class="fa fa-exclamation-circle me-2"></i>{{ error }}
    <button class="btn btn-sm btn-outline-danger ms-2" (click)="loadSensorTypes()">
        <i class="fa fa-refresh"></i> Retry
    </button>
</div>

<!-- Data Table -->
<card class="shadow-sm" *ngIf="!isLoading && !error">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover text-nowrap align-middle mb-0">
                <thead class="text-uppercase text-muted small">
                    <tr>
                        <th>ID</th>
                        <th>Category</th>
                        <th>Unit</th>
                        <th>Precision</th>
                        <th>Conversion Formula</th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let type of filteredSensorTypes">
                        <td class="fw-semibold text-muted small font-monospace">
                            {{ type.idSensorType.substring(0, 8) }}...
                        </td>
                        <td>
                            <span class="badge bg-primary bg-opacity-25 text-primary">{{ type.category }}</span>
                        </td>
                        <td>
                            <span class="badge bg-dark bg-opacity-25 text-uppercase">
                                {{ type.defaultUnit || 'N/A' }}
                            </span>
                        </td>
                        <td>{{ type.precision || '-' }}</td>
                        <td>
                            <code *ngIf="type.conversionFormula" class="small text-success">
                                {{ type.conversionFormula }}
                            </code>
                            <span *ngIf="!type.conversionFormula" class="text-muted small">Linear (default)</span>
                        </td>
                        <td class="text-end">
                            <div class="btn-group btn-group-sm" role="group">
                                <button 
                                    class="btn btn-outline-primary" 
                                    (click)="openEditDrawer(type)"
                                    title="Edit"
                                >
                                    <i class="fa fa-edit"></i>
                                </button>
                                <button 
                                    class="btn btn-outline-danger" 
                                    (click)="deleteSensorType(type.idSensorType)"
                                    title="Delete"
                                >
                                    <i class="fa fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="text-center text-muted py-4 border-top" *ngIf="!filteredSensorTypes.length">
            <i class="fa fa-inbox fa-2x mb-2"></i>
            <div>Tidak ada sensor type sesuai pencarian.</div>
        </div>
    </div>
</card>

<app-sensor-type-drawer 
    [isOpen]="isDrawerOpen" 
    [editData]="editingType"
    (close)="handleDrawerClose()"
    (save)="handleDrawerSave($event)">
</app-sensor-type-drawer>
