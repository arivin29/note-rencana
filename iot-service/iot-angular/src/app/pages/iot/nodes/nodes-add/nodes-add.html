<div class="d-flex align-items-center mb-3">
    <div>
        <ul class="breadcrumb mb-1">
            <li class="breadcrumb-item"><a href="javascript:;">IoT</a></li>
            <li class="breadcrumb-item"><a routerLink="/iot/nodes">Nodes</a></li>
            <li class="breadcrumb-item active">Deploy Node</li>
        </ul>
        <h1 class="page-header mb-0">Deploy New Node</h1>
    </div>
    <div class="ms-auto">
        <a routerLink="/iot/nodes" class="btn btn-outline-default me-2">
            <i class="fa fa-arrow-left fa-fw me-1"></i>
            Back to Nodes
        </a>
        <button class="btn btn-theme">
            <i class="fa fa-save fa-fw me-1"></i>
            Save Node
        </button>
    </div>
</div>

<div class="row">
    <div class="col-xl-9">
        <card id="sectionOwnership" class="border-0 shadow-sm mb-4">
            <div class="card-header border-0 bg-transparent">
                <div class="card-title mb-0">Ownership & Project</div>
                <div class="text-muted small">Hubungkan node dengan owner serta project sesuai struktur multi-tenant.
                </div>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label text-uppercase small text-muted">Owner</label>
                        <select class="form-select" [ngModel]="form.ownerId" (ngModelChange)="onOwnerChange($event)">
                            <option *ngFor="let owner of ownerOptions" [value]="owner.id">{{ owner.name }}</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label text-uppercase small text-muted">Project</label>
                        <select class="form-select" [ngModel]="form.projectId"
                            (ngModelChange)="onProjectChange($event)">
                            <option *ngFor="let project of projectOptions" [value]="project.id">{{ project.name }}
                            </option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label text-uppercase small text-muted">Node Model</label>
                        <select class="form-select" [(ngModel)]="form.nodeModelId"
                            [ngModelOptions]="{standalone: true}">
                            <option *ngFor="let model of nodeModels" [value]="model.id">
                                {{ model.vendor }} â€“ {{ model.model }}
                            </option>
                        </select>
                    </div>
                </div>
            </div>
        </card>

        <card id="sectionIdentity" class="border-0 shadow-sm mb-4">
            <div class="card-header border-0 bg-transparent">
                <div class="card-title mb-0">Node Identity & Telemetry</div>
                <div class="text-muted small">Isi metadata perangkat agar status dan audit trail lengkap.</div>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">Node Code</label>
                        <input class="form-control" placeholder="ex: NODE-120" [(ngModel)]="form.code"
                            [ngModelOptions]="{standalone: true}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Serial Number</label>
                        <input class="form-control" placeholder="Hardware Serial" [(ngModel)]="form.serialNumber"
                            [ngModelOptions]="{standalone: true}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Install Date</label>
                        <input type="date" class="form-control" [(ngModel)]="form.installDate"
                            [ngModelOptions]="{standalone: true}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">DevEUI</label>
                        <input class="form-control" placeholder="A84041B6C1D2E3F4" [(ngModel)]="form.devEui"
                            [ngModelOptions]="{standalone: true}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">IP Address</label>
                        <input class="form-control" placeholder="192.168.1.20" [(ngModel)]="form.ipAddress"
                            [ngModelOptions]="{standalone: true}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Firmware Version</label>
                        <input class="form-control" placeholder="v1.3.2" [(ngModel)]="form.firmwareVersion"
                            [ngModelOptions]="{standalone: true}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Battery Type</label>
                        <select class="form-select" [(ngModel)]="form.batteryType"
                            [ngModelOptions]="{standalone: true}">
                            <option *ngFor="let type of batteryTypes" [value]="type">{{ type }}</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Telemetry Mode</label>
                        <select class="form-select" [(ngModel)]="form.telemetryMode"
                            [ngModelOptions]="{standalone: true}">
                            <option *ngFor="let mode of telemetryModes" [value]="mode">{{ mode | titlecase }}</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Telemetry Interval (sec)</label>
                        <input type="number" class="form-control" min="30" step="30"
                            [(ngModel)]="form.telemetryInterval" [ngModelOptions]="{standalone: true}">
                    </div>
                </div>
            </div>
        </card>

        <card id="sectionLocation" class="border-0 shadow-sm mb-4">
            <div class="card-header border-0 bg-transparent">
                <div class="card-title mb-0">Lokasi & Assignment</div>
                <div class="text-muted small">Catat koordinat aktual beserta elevasi dan alamat untuk tracking
                    mobilitas.</div>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Lokasi Type</label>
                        <select class="form-select" [(ngModel)]="form.locationType"
                            [ngModelOptions]="{standalone: true}">
                            <option value="manual">Manual</option>
                            <option value="gps">GPS</option>
                            <option value="import">Import</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Latitude</label>
                        <input class="form-control" placeholder="-6.2213" [(ngModel)]="form.latitude"
                            [ngModelOptions]="{standalone: true}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Longitude</label>
                        <input class="form-control" placeholder="106.8432" [(ngModel)]="form.longitude"
                            [ngModelOptions]="{standalone: true}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Elevation (m)</label>
                        <input type="number" class="form-control" [(ngModel)]="form.elevation"
                            [ngModelOptions]="{standalone: true}">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Address / Note</label>
                        <textarea class="form-control" rows="2" [(ngModel)]="form.address"
                            [ngModelOptions]="{standalone: true}"></textarea>
                    </div>
                </div>
            </div>
        </card>

      

        <card id="sectionPreview" class="border-0 shadow-sm">
            <div class="card-header border-0 bg-transparent">
                <div class="card-title mb-0">Preview Payload</div>
                <div class="text-muted small">Pratinjau struktur JSON yang akan dikirim ke API metadata.</div>
            </div>
            <div class="card-body">
                <pre class="bg-dark text-white rounded-3 p-3 small mb-0">{{ payloadPreview | json }}</pre>
            </div>
        </card>
    </div>
    <div class="col-xl-3">
        <div class="sticky-top" style="top: 6rem;">
            <nav-scroll>
                <a class="nav-link" href="#sectionOwnership" data-toggle="scroll-to">Ownership &amp; Project</a>
                <a class="nav-link" href="#sectionIdentity" data-toggle="scroll-to">Identity &amp; Telemetry</a>
                <a class="nav-link" href="#sectionLocation" data-toggle="scroll-to">Lokasi &amp; Assignment</a>
                <a class="nav-link" href="#sectionSensors" data-toggle="scroll-to">Sensor Stack</a>
                <a class="nav-link" href="#sectionPreview" data-toggle="scroll-to">Payload Preview</a>
            </nav-scroll>
        </div>
    </div>
</div>