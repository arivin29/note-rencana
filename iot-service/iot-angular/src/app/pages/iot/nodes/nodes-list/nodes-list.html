<div class="d-flex align-items-center mb-3">
    <div>
        <ul class="breadcrumb mb-1">
            <li class="breadcrumb-item"><a href="javascript:;">IoT</a></li>
            <li class="breadcrumb-item active">Nodes</li>
        </ul>
        <h1 class="page-header mb-0">
            IoT Nodes
            <span *ngIf="projectIdFilter" class="badge bg-theme ms-2">
                <i class="fa fa-filter me-1"></i>
                Filtered by Project
            </span>
        </h1>
    </div>
    <div class="ms-auto">
        <a *ngIf="projectIdFilter" 
           routerLink="/iot/nodes" 
           class="btn btn-outline-secondary me-2">
            <i class="fa fa-times me-1"></i>
            Clear Filter
        </a>
        <a routerLink="/iot/nodes/new" class="btn btn-outline-theme">
            <i class="fa fa-plus-circle fa-fw me-1"></i>
            Deploy Node
        </a>
    </div>
</div>

<div class="mb-sm-4 mb-3 d-sm-flex">
    <div class="mt-sm-0 mt-2">
        <a href="javascript:;" class="text-inverse text-opacity-75 text-decoration-none">
            <i class="fa fa-download fa-fw me-1 text-theme"></i>
            Export Nodes
        </a>
    </div>
    <div class="ms-sm-4 mt-sm-0 mt-2">
        <a href="javascript:;" class="text-inverse text-opacity-75 text-decoration-none">
            <i class="fa fa-sync fa-fw me-1 text-theme"></i>
            Sync Telemetry
        </a>
    </div>
    <div class="ms-sm-4 mt-sm-0 mt-2 dropdown">
        <a href="javascript:;" class="text-inverse text-opacity-75 text-decoration-none dropdown-toggle"
            data-bs-toggle="dropdown">
            More Actions
        </a>
        <div class="dropdown-menu dropdown-menu-end">
            <a class="dropdown-item" href="javascript:;">Schedule Maintenance</a>
            <a class="dropdown-item" href="javascript:;">Bulk Assign</a>
            <div role="separator" class="dropdown-divider"></div>
            <a class="dropdown-item" href="javascript:;">Archive Node</a>
        </div>
    </div>
</div>
<card class="shadow-sm">
    <ul class="nav nav-tabs nav-tabs-v2 px-4">
        <li class="nav-item me-3" *ngFor="let option of statusOptions">
            <a href="javascript:;" class="nav-link px-2 d-flex align-items-center gap-2"
                [class.active]="filters.status === option" (click)="setFilter('status', option)">
                <span>{{ option === 'All Status' ? 'All' : (option | titlecase) }}</span>
                <span class="badge rounded-pill bg-body text-inverse text-opacity-75 border">
                    {{ statusCount(option) }}
                </span>
            </a>
        </li>
    </ul>
    <div class="p-4">
        <div class="row g-3 mb-4">
            <div class="col-lg-4 col-md-6">
                <label class="text-muted text-uppercase small d-block mb-1">Owner</label>
                <div class="dropdown w-100">
                    <button class="btn btn-outline-default dropdown-toggle w-100 text-start" type="button"
                        data-bs-toggle="dropdown">
                        {{ filters.owner }}
                    </button>
                    <div class="dropdown-menu w-100">
                        <button type="button" class="dropdown-item" *ngFor="let option of ownerOptions"
                            (click)="setFilter('owner', option)">{{ option }}</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <label class="text-muted text-uppercase small d-block mb-1">Project</label>
                <div class="dropdown w-100">
                    <button class="btn btn-outline-default dropdown-toggle w-100 text-start" type="button"
                        data-bs-toggle="dropdown">
                        {{ filters.project }}
                    </button>
                    <div class="dropdown-menu w-100">
                        <button type="button" class="dropdown-item" *ngFor="let option of projectOptions"
                            (click)="setFilter('project', option)">{{ option }}</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-12">
                <label class="text-muted text-uppercase small d-block mb-1">Search</label>
                <div class="input-group">
                    <span class="input-group-text bg-transparent border-end-0 text-muted"><i
                            class="fa fa-search opacity-50"></i></span>
                    <input type="text" class="form-control border-start-0 ps-0" placeholder="Search node code / project"
                        [ngModel]="searchTerm" (ngModelChange)="onSearchChange($event)">
                </div>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-hover text-nowrap align-middle">
                <thead class="text-uppercase text-muted small">
                    <tr>
                        <th class="pt-0 pb-2 w-10px"></th>
                        <th class="pt-0 pb-2">Node</th>
                        <th class="pt-0 pb-2">Owner / Project</th>
                        <th class="pt-0 pb-2">Status</th>
                        <th class="pt-0 pb-2">Firmware</th>
                        <th class="pt-0 pb-2">Telemetry</th>
                        <th class="pt-0 pb-2 text-end">Last Seen</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let node of paginatedNodes">
                        <td class="w-10px align-middle">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" [id]="'node-' + node.code">
                                <label class="form-check-label" [for]="'node-' + node.code"></label>
                            </div>
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <div
                                    class="w-50px h-50px bg-inverse bg-opacity-25 rounded-3 d-flex align-items-center justify-content-center">
                                    <i class="fa fa-microchip text-theme"></i>
                                </div>
                                <div class="ms-3">
                                    <a [routerLink]="['/iot/nodes', node.idNode]"
                                        class="text-inverse text-opacity-75 text-decoration-none fw-semibold">
                                        {{ node.code }}
                                    </a>
                                    <div class="text-muted small">Telemetry {{ node.telemetryMode }}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="fw-semibold">{{ node.owner }}</div>
                            <div class="text-muted small">{{ node.project }}</div>
                        </td>
                        <td>
                            <span [class]="badgeClass(node.status)">{{ node.status | titlecase }}</span>
                        </td>
                        <td>
                            <div class="fw-semibold">{{ node.firmware }}</div>
                            <div class="text-muted small">Assigned image</div>
                        </td>
                        <td class="text-capitalize">
                            <div class="fw-semibold">{{ node.telemetryMode }}</div>
                            <div class="text-muted small">Reporting cadence</div>
                        </td>
                        <td class="text-end text-muted">{{ node.lastSeen }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div *ngIf="!filteredNodes.length" class="text-center text-muted py-5 border-top">
            Tidak ada node sesuai filter.
        </div>
        <div class="d-md-flex align-items-center mt-3">
            <div class="me-md-auto text-md-start text-center mb-2 mb-md-0">
                Showing {{ paginationStart }} to {{ paginationEnd }} of {{ totalEntries }} nodes
            </div>
            <div class="d-flex align-items-center justify-content-center mb-2 mb-md-0 me-md-3">
                <span class="text-muted small me-2 text-uppercase">Rows</span>
                <select class="form-select form-select-sm w-auto" [ngModel]="pageSize"
                    (ngModelChange)="changePageSize($event)">
                    <option *ngFor="let size of pageSizeOptions" [ngValue]="size">{{ size }}</option>
                </select>
            </div>
            <ul class="pagination mb-0 justify-content-center">
                <li class="page-item" [class.disabled]="currentPage === 1">
                    <a class="page-link" href="javascript:;" (click)="goToPage(currentPage - 1)">Previous</a>
                </li>
                <li class="page-item" *ngFor="let page of pageNumbers" [class.active]="page === currentPage">
                    <a class="page-link" href="javascript:;" (click)="goToPage(page)">{{ page }}</a>
                </li>
                <li class="page-item" [class.disabled]="currentPage === totalPages">
                    <a class="page-link" href="javascript:;" (click)="goToPage(currentPage + 1)">Next</a>
                </li>
            </ul>
        </div>
    </div>
</card>