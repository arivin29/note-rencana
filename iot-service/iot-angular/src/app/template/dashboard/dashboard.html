<div class="ops-console">
  <div class="row g-3 console-metrics">
    <div class="col-xxl-3 col-lg-6" *ngFor="let stat of statData">
      <card class="console-panel metric-panel h-100">
        <card-body>
          <div class="panel-head">
            <div class="panel-label">{{ stat.title }}</div>
            <card-expand-toggler class="icon-button"><i class="bi bi-fullscreen"></i></card-expand-toggler>
          </div>
          <div class="metric-body">
            <div>
              <div class="metric-value">{{ stat.total }}</div>
            </div>
            <div class="metric-chart">
              <apx-chart [series]="stat.chart.series" [chart]="stat.chart.options.chart"
                [colors]="stat.chart.options.colors" [plotOptions]="stat.chart.options.plotOptions"
                [stroke]="stat.chart.options.stroke"></apx-chart>
            </div>
          </div>
          <ul class="metric-meta">
            <li *ngFor="let info of stat.info">
              <i [ngClass]="info.icon"></i>
              {{ info.text }}
            </li>
          </ul>
        </card-body>
      </card>
    </div>
  </div>

  <div class="row g-3 mt-1 align-items-stretch">
    <div class="col-xl-6">
      <card class="console-panel h-100">
        <card-body>
          <div class="panel-head">
            <div>
              <div class="panel-label">Server Stats</div>
              <div class="panel-hint text-muted">CPU vs memory usage</div>
            </div>
            <card-expand-toggler class="icon-button"><i class="bi bi-fullscreen"></i></card-expand-toggler>
          </div>
          <div class="ratio ratio-21x9 mb-3 console-chart">
            <apx-chart [chart]="serverData.chart.options.chart" [series]="serverData.chart.series"
              [colors]="serverData.chart.options.colors" [xaxis]="serverData.chart.options.xaxis"
              [yaxis]="serverData.chart.options.yaxis" [fill]="serverData.chart.options.fill"
              [tooltip]="serverData.chart.options.tooltip" [plotOptions]="serverData.chart.options.plotOptions"
              [dataLabels]="serverData.chart.options.dataLabels" [grid]="serverData.chart.options.grid"
              [stroke]="serverData.chart.options.stroke" [legend]="serverData.chart.options.legend"></apx-chart>
          </div>
          <div class="row g-3">
            <div class="col-lg-6" *ngFor="let stat of serverData.stats">
              <div class="telemetry-tile">
                <div class="tile-chart">
                  <apx-chart [chart]="stat.chart.options.chart" [series]="stat.chart.series"
                    [colors]="stat.chart.options.colors" [plotOptions]="stat.chart.options.plotOptions"
                    [stroke]="stat.chart.options.stroke"></apx-chart>
                </div>
                <div class="tile-content">
                  <div class="tile-label">{{ stat.name }}</div>
                  <div class="tile-value">{{ stat.total }}</div>
                  <div class="progress progress-xs mb-2">
                    <div class="progress-bar bg-theme" [ngStyle]="{ width: stat.progress }"></div>
                  </div>
                  <div class="tile-meta text-muted">{{ stat.time }}</div>
                  <div class="tile-info" *ngFor="let info of stat.info">
                    <span class="dot" [ngClass]="info.class"></span>
                    <span class="flex-grow-1">{{ info.title }}</span>
                    <span>{{ info.value }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </card-body>
      </card>
    </div>

    <div class="col-xl-6">
      <card class="console-panel h-100">
        <card-body>
          <div class="panel-head">
            <div>
              <div class="panel-label">Traffic Analytics</div>
              <div class="panel-hint text-muted">Live geo & referral sources</div>
            </div>
            <card-expand-toggler class="icon-button"><i class="bi bi-fullscreen"></i></card-expand-toggler>
          </div>
          <div class="ratio ratio-21x9 console-chart mb-3">
            <div class="jvm-without-padding" id="trafficMapContainer"></div>
          </div>
          <div class="row g-4">
            <div class="col-lg-6">
              <div class="table-responsive console-table">
                <table class="table text-nowrap mb-0">
                  <thead>
                    <tr>
                      <th>Country</th>
                      <th class="text-end">Visits</th>
                      <th class="text-end">Pct</th>
                    </tr>
                  </thead>
                  <tbody *ngIf="trafficData.country; else noCountry">
                    <tr *ngFor="let country of trafficData.country" [ngClass]="country.class">
                      <td>{{ country.name }}</td>
                      <td class="text-end">{{ country.visits }}</td>
                      <td class="text-end">{{ country.pct }}</td>
                    </tr>
                  </tbody>
                </table>
                <ng-template #noCountry>
                  <div class="text-muted small py-3">No records found</div>
                </ng-template>
              </div>
            </div>
            <div class="col-lg-6">
              <div class="d-flex align-items-center gap-3">
                <div class="w-80px">
                  <apx-chart [chart]="trafficData.chart.options.chart" [colors]="trafficData.chart.options.colors"
                    [stroke]="trafficData.chart.options.stroke" [plotOptions]="trafficData.chart.options.plotOptions"
                    [series]="trafficData.chart.series"></apx-chart>
                </div>
                <div class="flex-grow-1">
                  <div class="table-responsive console-table">
                    <table class="table mb-0 text-nowrap">
                      <tbody *ngIf="trafficData.source; else noSource">
                        <tr *ngFor="let source of trafficData.source">
                          <td>
                            <div class="d-flex align-items-center gap-2">
                              <span class="dot" [ngClass]="source.class"></span>
                              {{ source.name }}
                            </div>
                          </td>
                          <td class="text-end">{{ source.percentage }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <ng-template #noSource>
                    <div class="text-muted small py-3">No records found</div>
                  </ng-template>
                </div>
              </div>
            </div>
          </div>
        </card-body>
      </card>
    </div>
  </div>

  <div class="row g-3 mt-1">
    <div class="col-xl-6">
      <card class="console-panel h-100">
        <card-body>
          <div class="panel-head">
            <div>
              <div class="panel-label">Top Products</div>
              <div class="panel-hint text-muted">Revenue & margin snapshot</div>
            </div>
            <card-expand-toggler class="icon-button"><i class="bi bi-fullscreen"></i></card-expand-toggler>
          </div>
          <div class="table-responsive console-table">
            <table class="table align-middle text-nowrap mb-0">
              <tbody *ngIf="productData; else noProducts">
                <tr *ngFor="let product of productData; let i = index">
                  <td>
                    <div class="d-flex">
                      <div class="position-relative">
                        <div class="bg-position-center bg-size-cover product-thumb"
                          [ngStyle]="{ backgroundImage: 'url('+ product.img +')' }"></div>
                        <span class="badge index-badge">{{ i + 1 }}</span>
                      </div>
                      <div class="ps-3">
                        <div class="sku-badge">{{ product.sku }}</div>
                        <div class="fw-semibold">{{ product.title }}</div>
                        <div class="text-muted">{{ product.price }}</div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="product-meta">
                      <div><span>Qty</span><strong>{{ product.qty }}</strong></div>
                      <div><span>Revenue</span><strong>{{ product.revenue }}</strong></div>
                      <div><span>Profit</span><strong>{{ product.profit }}</strong></div>
                    </div>
                  </td>
                  <td class="text-end">
                    <a href="javascript:;" class="text-decoration-none text-muted"><i class="bi bi-search"></i></a>
                  </td>
                </tr>
              </tbody>
            </table>
            <ng-template #noProducts>
              <div class="text-muted small py-3">No records found</div>
            </ng-template>
          </div>
        </card-body>
      </card>
    </div>
    <div class="col-xl-6">
      <card class="console-panel h-100">
        <card-body>
          <div class="panel-head">
            <div>
              <div class="panel-label">Activity Log</div>
              <div class="panel-hint text-muted">Latest automation + manual tasks</div>
            </div>
            <card-expand-toggler class="icon-button"><i class="bi bi-fullscreen"></i></card-expand-toggler>
          </div>
          <div class="table-responsive console-table">
            <table class="table table-borderless align-middle text-nowrap mb-0">
              <tbody *ngIf="activityLogData; else noActivity">
                <tr *ngFor="let log of activityLogData">
                  <td>
                    <span class="d-flex align-items-center gap-2">
                      <i class="bi bi-circle-fill fs-6px"
                        [ngClass]="{ 'text-theme': log.highlight, 'text-secondary': !log.highlight }"></i>
                      {{ log.title }}
                    </span>
                  </td>
                  <td class="text-muted small">{{ log.time }}</td>
                  <td class="text-end">
                    <span class="badge rounded-pill px-3"
                      [ngClass]="{ 'bg-theme text-theme-900': log.highlight, 'bg-body text-muted': !log.highlight }">
                      {{ log.badge }}
                    </span>
                  </td>
                  <td class="text-end">
                    <a href="javascript:;" class="text-decoration-none text-muted"><i class="bi bi-search"></i></a>
                  </td>
                </tr>
              </tbody>
            </table>
            <ng-template #noActivity>
              <div class="text-muted small py-3">No records found</div>
            </ng-template>
          </div>
        </card-body>
      </card>
    </div>
  </div>
</div>
